<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ephemeral-chat | SSH</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0d0d0d;
      color: #00ff00;
      font-family: 'Fira Code', 'Courier New', monospace;
      height: 100vh;
      overflow: hidden;
      padding: 20px;
      line-height: 1.6;
    }
    #terminal {
      width: 100%;
      height: 100%;
      background: #000;
      border: 1px solid #00ff00;
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }
    .line {
      display: flex;
      align-items: flex-start;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .prompt {
      color: #00ff00;
      margin-right: 8px;
    }
    .input-line {
      display: flex;
      align-items: center;
    }
    #input {
      background: transparent;
      border: none;
      color: #00ff00;
      font-family: inherit;
      font-size: inherit;
      outline: none;
      flex: 1;
      caret-color: #00ff00;
    }
    .cursor {
      display: inline-block;
      width: 10px;
      height: 1.2em;
      background: #00ff00;
      animation: blink 1s step-end infinite;
      margin-left: 2px;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    .system {
      color: #00aaaa;
      font-style: italic;
    }
    .typing {
      color: #888;
      font-size: 0.9em;
    }
    .header {
      color: #00ff00;
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .help {
      color: #00ff88;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div class="header">=== EPHEMERAL SSH CHAT v2.0 ===</div>
    <div id="output"></div>
    <div class="input-line">
      <span class="prompt" id="prompt">┌─[guest@chat ~]<br>└─$</span>
      <input id="input" autocomplete="off" autofocus />
      <span class="cursor"></span>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const BACKEND_URL = '<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ephemeral-chat | SSH</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0d0d0d;
      color: #00ff00;
      font-family: 'Fira Code', 'Courier New', monospace;
      height: 100vh;
      overflow: hidden;
      padding: 20px;
      line-height: 1.6;
    }
    #terminal {
      width: 100%;
      height: 100%;
      background: #000;
      border: 1px solid #00ff00;
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }
    .line {
      display: flex;
      align-items: flex-start;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .prompt {
      color: #00ff00;
      margin-right: 8px;
    }
    .input-line {
      display: flex;
      align-items: center;
    }
    #input {
      background: transparent;
      border: none;
      color: #00ff00;
      font-family: inherit;
      font-size: inherit;
      outline: none;
      flex: 1;
      caret-color: #00ff00;
    }
    .cursor {
      display: inline-block;
      width: 10px;
      height: 1.2em;
      background: #00ff00;
      animation: blink 1s step-end infinite;
      margin-left: 2px;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    .system {
      color: #00aaaa;
      font-style: italic;
    }
    .typing {
      color: #888;
      font-size: 0.9em;
    }
    .header {
      color: #00ff00;
      text-align: center;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .help {
      color: #00ff88;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div id="terminal">
    <div class="header">=== EPHEMERAL SSH CHAT v2.0 ===</div>
    <div id="output"></div>
    <div class="input-line">
      <span class="prompt" id="prompt">┌─[guest@chat ~]<br>└─$</span>
      <input id="input" autocomplete="off" autofocus />
      <span class="cursor"></span>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const BACKEND_URL = 'ephemeral-chat-backend-production-1085.up.railway.app';
    const output = document.getElementById('output');
    const input = document.getElementById('input');
    const prompt = document.getElementById('prompt');
    let socket;
    let username = 'guest';
    let currentCode = '';
    let typingTimer;

    function addLine(text, type = 'normal') {
      const line = document.createElement('div');
      line.className = `line ${type}`;
      line.innerHTML = text;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    function setPrompt(name) {
      prompt.innerHTML = `┌─[${name}@${currentCode || 'chat'} ~]<br>└─$`;
    }

    function sendCommand(cmd) {
      if (!cmd.trim()) return;
      addLine(`┌─[${username}@${currentCode || 'chat'} ~]<br>└─$ ${cmd}`);

      if (cmd === 'clear') {
        output.innerHTML = '';
        return;
      }
      if (cmd === 'help') {
        addLine(`<span class="help">
  help     show this menu<br>
  clear    clear screen<br>
  who      show online users<br>
  exit     leave chat<br>
  [any]    send message
        </span>`);
        return;
      }
      if (cmd === 'exit') {
        if (socket) socket.emit('leave');
        location.reload();
        return;
      }
      if (cmd === 'who') {
        addLine('<span class="system">Requesting user list...</span>');
        if (socket) socket.emit('request users');
        return;
      }

      if (socket && currentCode) {
        socket.emit('chat message', cmd);
      } else {
        addLine('<span class="system">Not in a chat. Use a code to join.</span>');
      }
    }

    // Join chat
    const urlParams = new URLSearchParams(window.location.search);
    const urlCode = urlParams.get('code');
    if (urlCode) {
      currentCode = urlCode;
      username = prompt('SSH Login: Enter your username', 'hacker') || 'guest';
      setPrompt(username);
      connectToChat(urlCode);
    } else {
      const code = prompt('Enter chat code to connect:')?.trim();
      if (code) {
        currentCode = code;
        username = prompt('SSH Login: Enter your username', 'hacker') || 'guest';
        history.pushState(null, '', `?code=${code}`);
        setPrompt(username);
        connectToChat(code);
      } else {
        addLine('<span class="system">No code provided. Reload and try again.</span>');
      }
    }

    function connectToChat(code) {
      socket = io(BACKEND_URL, { transports: ['websocket'] });

      socket.on('connect', () => {
        socket.emit('join', { code, username });
        addLine(`<span class="system">Connected to ${code}. Type 'help' for commands.</span>`);
      });

      socket.on('connect_error', () => {
        addLine('<span class="system" style="color:#ff5555">Connection failed. Check server.</span>');
      });

      socket.on('chat message', (data) => {
        if (data.username === username) return;
        addLine(`┌─[${data.username}@${currentCode} ~]<br>└─$ ${data.msg}`);
      });

      socket.on('system message', (msg) => {
        addLine(`<span class="system">* ${msg}</span>`);
      });

      socket.on('user typing', (name) => {
        clearTimeout(typingTimer);
        const typingEl = document.querySelector('.typing');
        if (!typingEl) {
          addLine(`<span class="typing">${name} is typing...</span>`);
        }
        typingTimer = setTimeout(() => {
          const el = document.querySelector('.typing');
          if (el) el.remove();
        }, 1000);
      });

      socket.on('chat closed', () => {
        addLine('<span class="system" style="color:#ff5555">Chat terminated. Data erased.</span>');
        setTimeout(() => location.reload(), 2000);
      });
    }

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = input.value.trim();
        input.value = '';
        sendCommand(cmd);
        if (socket && currentCode) socket.emit('typing', false);
      } else if (e.key.length === 1) {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(() => {
          if (socket) socket.emit('typing', true);
        }, 300);
      }
    });

    // Focus input
    input.focus();
    document.addEventListener('click', () => input.focus());
  </script>
</body>
</html>';
    const output = document.getElementById('output');
    const input = document.getElementById('input');
    const prompt = document.getElementById('prompt');
    let socket;
    let username = 'guest';
    let currentCode = '';
    let typingTimer;

    function addLine(text, type = 'normal') {
      const line = document.createElement('div');
      line.className = `line ${type}`;
      line.innerHTML = text;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    function setPrompt(name) {
      prompt.innerHTML = `┌─[${name}@${currentCode || 'chat'} ~]<br>└─$`;
    }

    function sendCommand(cmd) {
      if (!cmd.trim()) return;
      addLine(`┌─[${username}@${currentCode || 'chat'} ~]<br>└─$ ${cmd}`);

      if (cmd === 'clear') {
        output.innerHTML = '';
        return;
      }
      if (cmd === 'help') {
        addLine(`<span class="help">
  help     show this menu<br>
  clear    clear screen<br>
  who      show online users<br>
  exit     leave chat<br>
  [any]    send message
        </span>`);
        return;
      }
      if (cmd === 'exit') {
        if (socket) socket.emit('leave');
        location.reload();
        return;
      }
      if (cmd === 'who') {
        addLine('<span class="system">Requesting user list...</span>');
        if (socket) socket.emit('request users');
        return;
      }

      if (socket && currentCode) {
        socket.emit('chat message', cmd);
      } else {
        addLine('<span class="system">Not in a chat. Use a code to join.</span>');
      }
    }

    // Join chat
    const urlParams = new URLSearchParams(window.location.search);
    const urlCode = urlParams.get('code');
    if (urlCode) {
      currentCode = urlCode;
      username = prompt('SSH Login: Enter your username', 'hacker') || 'guest';
      setPrompt(username);
      connectToChat(urlCode);
    } else {
      const code = prompt('Enter chat code to connect:')?.trim();
      if (code) {
        currentCode = code;
        username = prompt('SSH Login: Enter your username', 'hacker') || 'guest';
        history.pushState(null, '', `?code=${code}`);
        setPrompt(username);
        connectToChat(code);
      } else {
        addLine('<span class="system">No code provided. Reload and try again.</span>');
      }
    }

    function connectToChat(code) {
      socket = io(BACKEND_URL, { transports: ['websocket'] });

      socket.on('connect', () => {
        socket.emit('join', { code, username });
        addLine(`<span class="system">Connected to ${code}. Type 'help' for commands.</span>`);
      });

      socket.on('connect_error', () => {
        addLine('<span class="system" style="color:#ff5555">Connection failed. Check server.</span>');
      });

      socket.on('chat message', (data) => {
        if (data.username === username) return;
        addLine(`┌─[${data.username}@${currentCode} ~]<br>└─$ ${data.msg}`);
      });

      socket.on('system message', (msg) => {
        addLine(`<span class="system">* ${msg}</span>`);
      });

      socket.on('user typing', (name) => {
        clearTimeout(typingTimer);
        const typingEl = document.querySelector('.typing');
        if (!typingEl) {
          addLine(`<span class="typing">${name} is typing...</span>`);
        }
        typingTimer = setTimeout(() => {
          const el = document.querySelector('.typing');
          if (el) el.remove();
        }, 1000);
      });

      socket.on('chat closed', () => {
        addLine('<span class="system" style="color:#ff5555">Chat terminated. Data erased.</span>');
        setTimeout(() => location.reload(), 2000);
      });
    }

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = input.value.trim();
        input.value = '';
        sendCommand(cmd);
        if (socket && currentCode) socket.emit('typing', false);
      } else if (e.key.length === 1) {
        clearTimeout(typingTimer);
        typingTimer = setTimeout(() => {
          if (socket) socket.emit('typing', true);
        }, 300);
      }
    });

    // Focus input
    input.focus();
    document.addEventListener('click', () => input.focus());
  </script>
</body>
</html>